---
title: Installing and Configuring Compliance Scanner
owner: Pivotal Compliance and Innovation (PCI) Team
---
<strong><%= modified_date %></strong>

This topic describes how to install and configure <%= vars.product_full %>.

## <a id='prerequisite'></a> Prerequisite

<%= vars.product_short %> runs a scanner daemon on each VM that requires ~100&nbsp;MB of memory.
Before you install <%= vars.product_full %>, you might need to resize your VMs accordingly.

## <a id='install'></a> Install <%= vars.product_short %>
To install the <%= vars.product_short %> file on the Ops Manager Installation Dashboard:

1. Download the product file from [Pivotal Network](https://network.pivotal.io/products/compliance/).

1. Navigate to the Ops Manager Installation Dashboard and click **Import a Product** to upload the product file.

1. Under the **Import a Product** button, click **+** next to the version number of <%= vars.product_short %>.
This adds the tile to your staging area.

1. Click the newly added **<%= vars.product_short %>** tile.

## <a id='azs-networks'></a> Configure AZs and Networks
To configure your AZs and Networks:

1. Select **Assign AZs and Networks**.

    <%= image_tag("azs-networks.png", :alt => "Assign AZs and Networks page") %>

<%# TODO: Needs screenshot!!! %>

1. Configure the fields:

    <table class="nice">
      <th>Field</th>
      <th>Description</th>
      <tr>
        <td><strong>Place singleton jobs in</strong></td>
        <td>Select the AZ that you want the <code>oscap_store</code> VM to run in.<br>
          The tile runs as a singleton job.</td>
      </tr>
      <tr>
        <td><strong>Balance other jobs in</strong></td>
        <td>Select the same AZ as above.</td>
      </tr>
      <tr>
        <td><strong>Network</strong></td>
        <td>Select a subnet for the <code>oscap_store</code> VM. <br>This is typically the same subnet that
          includes the Pivotal Application Services (PAS) component VMs.</td>
      </tr>
    </table>

1. Click **Save**.

## <a id='system-variables'></a> Configure System Variables
This section is where you configure expected values for tests and select which set of benchmarks to run.
To configure your system variables:

1. Select **System Variables**.

    <%= image_tag("system-var.png", :alt => "System Variables page") %>

1. Configure the fields in **System Variables** to provide the expected values for the tests:

    <table class="nice">
        <th>Field</th>
        <th>Description</th>
        <tr><td><strong>NTP Server IP</strong></td>
                <td>The IP address of your NTP server.<br> <br>You can find this IP address in
                  <strong>Bosh Director</strong> > <strong>Director Config</strong> >
                  <strong>NTP Server</strong>. You can only enter one server IP address. It does not
                  matter which NTP server you enter.
                </td>
        </tr>
        <tr><td><strong>Syslog Host IP</strong></td>
                <td>The IP address of your syslog host.<br><br>
                    You can find this in your PAS tile under
                    <strong>Settings > System Logging > Address</strong>.</td>
        </tr>
        <tr><td><strong>Syslog Port</strong></td>
                <td>The port number of the syslog port.<br><br>
                    You can find this in your PAS tile under
                    <strong>Settings > System Logging > Port</strong>.</td>
        </tr>
        <tr><td><strong>Custom SSH Banner</strong></td>
                <td>The text expected when verifying the login SSH Banner on VMs during a scan.<br><br>
                    The default value (which comes from the stemcell) is:<br>
                    <code>Unauthorized use is strictly prohibited. All access and activity is subject to logging and monitoring.</code>

                    If you modified this text in your stemcell, then enter the modified text in this field.
                  </td>
        </tr>
    </table>

1. Click **Save**.

## <a id='scans'></a> Configure Scans
To configure scans:

1. Select **Scan Configuration**.

    <%= image_tag("scan-config.png", :alt => "Scan Configuration page", :width => "300") %>

1. Enable **Scan Report Formats**. You must select at least one format.
   The outputs of a scan can be in LOG, XML, and HTML formats.

1. Enable **Benchmarks** for the scanner to run:

    <table class="nice">
        <th>Benchmark</th>
        <th>Description</th>
        <tr><td><strong>Base Xenial</strong></td>
                <td>Includes a subset of the amended tests in the STIG benchmark,
                    where failing tests due to architectural differences are removed.<br>
                This is meant to be used as a measure to see if configurations have been altered.<br></td>
        </tr>
    	<tr><td><strong>Recommended Security Baseline</strong></td>
                <td>A benchmark with rules that all systems should implement, regardless of user
                  environment or the sensitivity of the app data being processed.</td>
        </tr>
        <tr><td><strong>Strict Security Practices</strong></td>
                <td>A benchmark with strict rules that are required of systems processing sensitive
                  data or workloads. This is meant to run in addition to the tests in the recommended
                  security baseline benchmark.</td>
        </tr>
        <tr><td><strong>STIG for Ubuntu Xenial</strong></td>
                <td>Includes all the configuration tests of the published DISA STIG
                  for Ubuntu 16.04, amended with stemcell specific changes. Contains tests that would
                  fail due to architectural differences.</td>
    </table>
    <br><br>
    A scan report is generated for each format and benchmark on each Linux VM running on Xenial stemcells.
    For example, if you select **.xml** and **.csv** formats,
    and **Base Xenial** and **STIG** benchmarks, four CSV files are created for each VM tested.
    <br><br>
    For more information about <%= vars.product_short %> benchmarks, see [Benchmarks](./benchmarks.html).

1. For **Scanner Timeout**, configure the maximum time in seconds permitted for a scan.
    The default value is `1200`.

1. For **Enforce CPU limit**, configure the CPU limit percentage (between `1` and `100`)
  that the Scanner is allowed to use.
  The default value is `Disable`.

    <p class="note"><strong>Note:</strong>
      <strong>Enforce CPU limit</strong> affects only 1 core. For example:
       In a system with four cores with a CPU limit set to <code>100</code>,
       the scanner only uses one of the four cores.
      </p>

1. Click **Save**.

## <a id='scheduled-scan'></a> Configure Scheduled Scan
<%= vars.product_short %> can be configured to run a scan at a scheduled time and day of the week.
<br>The default values are `"00:00"` and `Sunday`.

<p class="note"><strong>Note:</strong>
Pivotal recommends setting up external storage to store the scan result reports.
If you do not do this, <%= vars.product_short %> will overwrite your previous local reports.
For more information on setting up external storage, see
<a href="#external-store">(Optional) Configure External Store Upload</a> below.
</p>

To change the scheduled scan values:

1. Select **Scheduled Scans**.

    <%= image_tag("scheduled-scans.png", :alt => "Scheduled Scans Configuration page", :width => "300") %>

1. Select **Enable**.
1. Set the **Scheduled scan start time** value.
  The **Scheduled scan start time** must be in 24-hour format `HH:MM`.
1. Select a **Scheduled scan day**.
  Only one value may be selected.
1. Click **Save**.

## <a id="external-store"></a> (Optional) Configure External Store Upload
To store scan results in an Amazon S3 bucket, a Minio S3-compatible bucket, or an Azure Blob Storage Container,
configure an external store upload.

If you configure an external store, then <%= vars.product_short %> uploads scan
results to that store.
This means that auditors do not need access to Ops Manager to download BOSH logs
or rely on the operator to give them scan results.
Additionally, when using a Security Information and Event Management (SIEM) system,
automating the consumption of the scan results is easier and does not require
access to the Ops Manager API.

If you do not use an external store for scan results, then the scan results are stored in the `oscap_store` VM.
For more information, see [Retrieve Log Files](./using.html#review-tile).

### <a id="s3-bucket"></a>S3 bucket
To configure an external store upload using an S3 bucket:

1. Select **External Store Upload**
1. Select **AWS S3 Bucket**.

      <%= image_tag("bucket-aws.png", :alt => "The External Store Upload page in Ops Manager with the AWS S3 Bucket radio button selected.", :width => "500") %>

1. Configure the fields:

      <table class="nice">
        <th>Field</th>
        <th>Description</th>
        <tr>
          <td><strong>Bucket Name</strong></td>
          <td>Enter the name of the bucket.</td>
        </tr>
        <tr>
          <td><strong>Bucket Region</strong></td>
          <td>Select the region that the bucket was created in.</td>
        </tr>
        <tr>
          <td><strong>Access Key ID</strong></td>
          <td>Enter the access key ID for AWS credentials with access to the bucket. <br>
            Pivotal recommends that you ensure the credentials permit write access to just this bucket.</td>
        </tr>
        <tr>
          <td><strong>Secret Access Key</strong></td>
          <td>Enter the access key secret for AWS credentials with access to the bucket. <br>
            Pivotal recommends that you ensure the credentials permit write access to just this bucket.</td>
        </tr>
      </table>

1. Click **Save**.

### <a id="minio-bucket"></a>Minio bucket
To configure an external store upload using a Minio bucket:

1. Select **External Store Upload**
1. Select **Minio Bucket**.

      <%= image_tag("bucket-minio.png", :alt => "The External Store Upload page in Ops Manager with the Minio Bucket radio button selected.", :width => "500") %>

1. Configure the fields:

      <table class="nice">
        <th>Field</th>
        <th>Description</th>
        <tr>
          <td><strong>Bucket Name</strong></td>
          <td>Enter the name of the bucket.</td>
        </tr>
        <tr>
          <td><strong>Minio Host</strong></td>
          <td>Enter the fully qualified domain name of the Minio server.
            This can include a port, but should not specify the protocol. <br>
            For instance, <code>example.domain.com:9000</code> is a valid host.</td>
        </tr>
        <tr>
          <td><strong>Bucket Region</strong></td>
          <td>If your Minio configuration specifies a region, enter that region here. <br>
            Otherwise, this field can be left blank.</td>
        </tr>
        <tr>
          <td><strong>Access Key ID</strong></td>
          <td>Enter the access key ID for the Minio server.</td>
        </tr>
        <tr>
          <td><strong>Secret Access Key</strong></td>
          <td>Enter the access key secret for the Minio server.</td>
        </tr>
        <tr>
          <td><strong>Bucket CA Certificate</strong></td>
          <td>Enter the CA Certificate used by the Minio server, if applicable.
            If the Minio server does not use TLS, leave this field blank. <br><br>
            If the Minio server is a PAS service instance, this CA Certificate must match the
            <strong>SAML Service Provider Credentials</strong> field under the <strong>UAA</strong> form in your PAS tile.</td>
        </tr>
      </table>

1. Click **Save**.

### <a id="azure-blob"></a> Azure Blob Storage Container
To configure an external store upload using an Azure Blob:

1. Select **External Store Upload**
1. Select **Azure Blob Storage Container**.

      <%= image_tag("bucket-azure-blob.png", :alt => "The External Store Upload page in Ops Manager with the Azure Blob Storage Container radio button selected.", :width => "500") %>

1. Configure the fields:

      <table class="nice">
        <th>Field</th>
        <th>Description</th>
        <tr>
          <td><strong>Container URL</strong></td>
          <td>Enter the container URL for an existing Azure Blob Storage Container.
          Get this URL from the container properties in the Azure portal.
          For example: <code>https://mystorageaccount.blob.core.windows.net/mycontainername</code></td>
        </tr>
        <tr>
          <td><strong>Storage Account Name</strong></td>
          <td>Enter the storage account name for the Azure Blob Storage Container.</td>
        </tr>
        <tr>
          <td><strong>Storage Account Key</strong></td>
          <td>Enter the storage account key for the Azure Blob Storage Container.</td>
        </tr>
      </table>

1. Click **Save**.

## <a id="errands"></a> Configure Errands
<%= vars.product_short %> performs one errand that initiates scanning.
This errand is disabled by default.
This is so that a scan is not run every time changes are applied.

When this errand is triggered, it initiates the scanning errand on each VM.
For more information about initiating the scanning errand, see [Using <%= vars.product_short %>](./using.html).

When configuring the <%= vars.product_short %> tile for the first time:

1. Select **Errands**.

    <%= image_tag("errands.png", :alt => "Errands page") %>

1. Confirm that **Run configured scans** is set to **Default (Off)**.

1. Click **Save**.

## <a id="resources"></a> Configure Resources
The tile creates a new VM called `oscap_store` to store the logs retrieved from all the other VMs
that have been scanned.

<p class="note"><strong>Note:</strong>
The <code>oscap_store</code> VM does not do anything computationally extensive.
Pivotal recommends using the default configurations.</p>

To configure resources:

1. Select **Resource Config**.

1. Click **Save**.

## <a id="apply-changes"></a> Apply Changes from Your Configuration
Your installation is not complete until you apply your configuration changes:

1. Return to the Ops Manager Installation Dashboard.

1. Click **Review Pending Changes**. Verify that all products are selected.

1. Click **Apply Changes** to complete the installation of <%= vars.product_short %>.
